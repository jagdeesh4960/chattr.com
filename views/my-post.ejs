<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>My Posts | Chattr</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
</head>
<body class="bg-black text-white min-h-screen flex flex-col">

  <!-- Page Content Wrapper -->
  <main class="flex-grow">

    <!-- Navbar -->
    <nav class="bg-pink-600 p-4 flex justify-between items-center">
      <a href="/" class="text-xl font-extrabold text-white tracking-wide">Chattr</a>
      <div>
        <a href="/post/create" class="text-sm bg-white text-pink-600 px-3 py-1 rounded mr-2">+ Post</a>
      </div>
    </nav>

    <!-- Header -->
    <header class="text-center py-6">
      <h1 class="text-3xl font-bold text-pink-500">Your Posts</h1>
      <p class="text-gray-400 text-sm">Here are all the posts you've shared on Chattr üßÉ</p>
    </header>

    <!-- Posts Grid -->
    <section class="max-w-4xl mx-auto px-4 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
      <% if (posts.length === 0) { %>
        <div class="col-span-full text-center text-gray-400">
          <p>You haven't posted anything yet üò∂</p>
        </div>
      <% } %>

      <% posts.forEach(post => { %>
        <div class="post bg-white text-black rounded-lg overflow-hidden shadow-lg hover:shadow-pink-600 transition duration-200 max-w-md mx-auto mb-6">
          <!-- Post Image -->
          <img src="<%= post.media.url %>" alt="Post image" class="w-full h-48 object-cover" />

          <!-- Caption + Date -->
          <div class="p-4">
            <h3 class="font-bold text-pink-600"><%= post.authorName %></h3>
            <p class="mt-2 text-sm font-medium"><%= post.caption %></p>
            <p class="text-xs text-gray-500 mt-1"><%= post.createdAt.toDateString() %></p>

            <!-- Like & Comment Buttons -->
            <div class="flex items-center justify-between mt-4">
              <button class="likeBtn text-pink-500 hover:text-pink-700 transition">
                ‚ù§Ô∏è <span class="likeText">Like</span>
              </button>
              <button class="commentBtn text-black hover:text-pink-600 transition">
                üí¨ Comment
              </button>
            </div>
          </div>

          <!-- Comment Panel -->
          <div class="commentPanel hidden bg-black text-white p-4 max-h-80 overflow-y-auto">
            <div class="mb-2">
              <input type="text" class="newComment w-full p-2 rounded bg-white text-black placeholder:text-gray-500" placeholder="Add a comment..." />
              <button class="postComment mt-2 bg-pink-500 text-white px-4 py-1 rounded hover:bg-pink-600">Post</button>
            </div>

            <div class="commentsContainer space-y-2 text-sm">
              <!-- Comments + 1-level replies go here -->
            </div>
          </div>
        </div>
      <% }) %>
    </section>

  </main>

  <!-- Footer -->
  <footer class="bg-pink-600 text-center py-4 mt-auto">
    <p class="text-white text-sm">¬© 2025 Chattr | Connect. Caption. Create.</p>
  </footer>

  <!-- Scripts -->
  <script>
    // Like & comment logic for each post
    document.querySelectorAll('.post').forEach(post => {
      let liked = false;

      const likeBtn = post.querySelector('.likeBtn');
      const likeText = post.querySelector('.likeText');
      const commentBtn = post.querySelector('.commentBtn');
      const commentPanel = post.querySelector('.commentPanel');
      const newCommentInput = post.querySelector('.newComment');
      const postCommentBtn = post.querySelector('.postComment');
      const commentsContainer = post.querySelector('.commentsContainer');

      // Like toggle
      likeBtn.addEventListener('click', () => {
        liked = !liked;
        likeText.textContent = liked ? 'Liked' : 'Like';
        likeBtn.classList.toggle('text-pink-700');
      });

      // Show/hide comment panel
      commentBtn.addEventListener('click', () => {
        commentPanel.classList.toggle('hidden');
      });

      // Post a comment
      postCommentBtn.addEventListener('click', () => {
        const commentText = newCommentInput.value.trim();
        if (!commentText) return;

        const commentDiv = document.createElement('div');
        commentDiv.classList.add('bg-white', 'text-black', 'p-2', 'rounded');

        commentDiv.innerHTML = `
          <div class="flex justify-between items-center">
            <span><strong>You:</strong> ${commentText}</span>
            <button class="replyBtn text-pink-500 text-xs">Reply</button>
          </div>
          <div class="ml-4 mt-2 reply-section hidden">
            <input type="text" placeholder="Reply..." class="w-full p-1 rounded bg-gray-100 text-black text-xs replyInput" />
            <button class="postReply text-xs text-white bg-pink-500 px-2 py-0.5 rounded mt-1">Post</button>
          </div>
        `;

        commentsContainer.appendChild(commentDiv);
        newCommentInput.value = '';

        const replyBtn = commentDiv.querySelector('.replyBtn');
        const replySection = commentDiv.querySelector('.reply-section');
        const replyInput = replySection.querySelector('.replyInput');
        const postReplyBtn = replySection.querySelector('.postReply');

        // Show reply input
        replyBtn.addEventListener('click', () => {
          replySection.classList.toggle('hidden');
        });

        // Post reply (only 1 level)
        postReplyBtn.addEventListener('click', () => {
          const replyText = replyInput.value.trim();
          if (!replyText) return;

          const replyDisplay = document.createElement('div');
          replyDisplay.classList.add('text-xs', 'bg-gray-100', 'text-black', 'rounded', 'p-2', 'mt-2');
          replyDisplay.innerHTML = `<strong>You (reply):</strong> ${replyText}`;

          // Remove reply input area after reply is posted
          replySection.remove();
          commentDiv.appendChild(replyDisplay);
        });
      });
    });

    // Profile dropdown (optional)
    function toggleDropdown() {
      const dropdown = document.getElementById("profileDropdown");
      dropdown.classList.toggle("hidden");
    }

    document.addEventListener("click", function (event) {
      const dropdown = document.getElementById("profileDropdown");
      const button = event.target.closest("button");
      if (dropdown && !dropdown.contains(event.target) && !button) {
        dropdown.classList.add("hidden");
      }
    });
  </script>
</body>
</html>
